<html lang="en">
<!-- Style is defined by CSS -->
<style>
*{
    margin: 0;
    padding: 0;
}
    .container{
        height: 100vh;
        width: 100%;
        padding-left: 5%;
        padding-right: 5%;
        box-sizing: border-box;
        position: relative;
    }
    #createAPlantSection {
        height: 100%;
        width: 50%;
        position: absolute;
        left: 0;
        top: 0;
    }

    #listOfPlantsSection {
        height: 100%;
        width: 50%;
        position: absolute;
        left: 50%;
        top: 0;
    }
</style>
<!-- Page content is defined as HTML body -->
<head>
    <title> Garden Journal</title>
</head>
<body>
<div class = "container">
<div id="createAPlantSection">
    <button id="createAPlantSectionLabel" onclick="onPlantCreate()">Create a Plant</button>
    <div id="show-error"></div>
    <form>
        <label>
            Name
            <input id="plantNameTextField" type="text" placeholder="plant">
        </label>
        <br/>
        <label>
            Color
            <input id="plantColorTextField" type="text" placeholder="#ffab02">
        </label>
        <br/>
        <label>
            Height in inches
            <input id="plantHeightTextField" type="text" placeholder="25">
        </label>
    </form>
</div>
<div id="listOfPlantsSection">
    <div id="listOfPlantsSectionLabel">Plants
        <br/>
        <label>
            Remove Plant
            <input id="plantIdTextField" type="text" placeholder="Id">
        </label>
        <button id="removeAPlantSectionLabel" onclick="removeAPlant()">Remove</button>
        <br/>
    </div>
    <div id="listOfPlants"></div>
</div>
</div>
</body>
<!-- Javascript defines what happens on the page -->
<script lang="javascript">
    const plantNameTextField = document.getElementById('plantNameTextField');
    const plantColorTextField = document.getElementById('plantColorTextField');
    const plantHeightTextField = document.getElementById('plantHeightTextField');
    const plantIdTextField = document.getElementById('plantIdTextField')
    const listOfPlants = document.getElementById('listOfPlants'); // a DIV element containing a list of DIV elements with plant information
    const errorDiv = document.querySelector('#show-error');


    function createListOfPlants() {
        // 1. fetch the list of all plants
        // 2. create divs for each plant
        // for (let i = 0; i < 10; ++i) {
        //     const newDiv = document.createElement('div');
        //     listOfPlants.appendChild(newDiv);
        //     newDiv.textContent = 'hello! ' + i;
        // }
        const getAPlantRequest = new XMLHttpRequest();
        getAPlantRequest.onreadystatechange = function () {
            // when response didn't come yet, move on
            if (this.readyState !== 4) return;

            // if status is error, throw
            if (this.status !== 200) {
                throw new Error(`status is ${this.status}`);
            }

            // if we succeeded, print the new plant's ID
            const listOfPlantsFromResponse = JSON.parse(this.responseText); // actual list of plants from the server
            console.log('received a plant', listOfPlantsFromResponse);

            // removes old elements from the list of plants
            // while(listOfPlants.children.length !==0) {
            //     listOfPlants.removeChild(listOfPlants.children[0]);
            // }
            // same as above but instead we clear HTML
            listOfPlants.innerHTML = '';

            for (let i = 0; i < listOfPlantsFromResponse.length; ++i) {
                const newDiv = document.createElement('div');
                listOfPlants.appendChild(newDiv);
                newDiv.textContent = JSON.stringify(listOfPlantsFromResponse[i]);
            }

        };

        getAPlantRequest.open('GET', 'http://localhost:8080/api/v1/plants', true);
        // actually send the request
        getAPlantRequest.send();

    }

    function removeAPlant() {
        const removeAPlantRequest = new XMLHttpRequest();

        removeAPlantRequest.onreadystatechange = function () {
            if (this.readyState !== 4) return;

            // if status is error, throw
            if (this.status !== 200) {
                throw new Error(`status is ${this.status}`);
            }

            console.log('removed a plant');


            plantIdTextField.value = '';

            createListOfPlants()

        }

        const url = 'http://localhost:8080/api/v1/plants';
        removeAPlantRequest.open('DELETE', url + '/' + plantIdTextField.value, true);
        // actually send the request
        removeAPlantRequest.send();


    }

    createListOfPlants();

    function onPlantCreate() {
        // create plant object
        if (plantNameTextField.value === "") {
            errorDiv.innerText = "Please, name your plant dumbass.";
            errorDiv.style.color = 'red';
            return;
        }

        const plant = {
            "name": plantNameTextField.value,
            "colorRed": 255,
            "colorGreen": 0,
            "colorBlue": 255,
            "heightInInches": plantHeightTextField.value
        };

        // send POST request to the server
        const createAPlantRequest = new XMLHttpRequest();
        createAPlantRequest.onreadystatechange = function () {
            // when response didn't come yet, move on
            if (this.readyState !== 4) return;

            // if status is error, throw
            if (this.status !== 201) {
                throw new Error(`status is ${this.status}`);
            }


            // if we succeeded, print the new plant's ID
            const plantId = this.responseText;
            console.log('created a plant', plantId, plant);

            // clear the input fields
            plantNameTextField.value = '';
            plantColorTextField.value = '';
            plantHeightTextField.value = '';

            createListOfPlants();

        };

        createAPlantRequest.open('POST', 'http://localhost:8080/api/v1/plants', true);
        // tell the server we are sending a JSON
        createAPlantRequest.setRequestHeader('Content-Type', 'application/json');
        // actually send the request
        createAPlantRequest.send(JSON.stringify(plant));

    }
</script>
</html>