<html lang="en">
<!-- Style is defined by CSS -->
<style>
    #createAPlantSection {
        height: 100%;
        width: 50%;
        position: absolute;
        left: 0;
        top: 0;
    }

    #listOfPlantsSection {
        height: 100%;
        width: 50%;
        position: absolute;
        left: 50%;
        top: 0;
    }
</style>
<!-- Page content is defined as HTML body -->
<body>
<div id="createAPlantSection">
    <button id="createAPlantSectionLabel" onclick="onPlantCreate()">Create a plant</button>
    <form>
        <label>
            name
            <input id="plantNameTextField" type="text" placeholder="Tomato">
        </label>
        <br/>
        <label>
            color
            <input id="plantColorTextField" type="text" placeholder="#ffab02">
        </label>
        <br/>
        <label>
            height in inches
            <input id="plantHeightTextField" type="text" placeholder="25">
        </label>
    </form>
</div>
<div id="listOfPlantsSection">
    <div id="listOfPlantsSectionLabel">List of plants</div>
    <div id="listOfPlants"></div>
</div>
</body>
<!-- Javascript defines what happens on the page -->
<script lang="javascript">
    const plantNameTextField = document.getElementById('plantNameTextField');
    const plantColorTextField = document.getElementById('plantColorTextField');
    const plantHeightTextField = document.getElementById('plantHeightTextField');
    const listOfPlants = document.getElementById('listOfPlants'); // a DIV element containing a list of DIV elements with plant information

    function createListOfPlants() {
        // 1. fetch the list of all plants
        // 2. create divs for each plant
        // for (let i = 0; i < 10; ++i) {
        //     const newDiv = document.createElement('div');
        //     listOfPlants.appendChild(newDiv);
        //     newDiv.textContent = 'hello! ' + i;
        // }
        const getAPlantRequest = new XMLHttpRequest();
        getAPlantRequest.onreadystatechange = function () {
            // when response didn't come yet, move on
            if (this.readyState !== 4) return;

            // if status is error, throw
            if (this.status !== 200) {
                throw new Error(`status is ${this.status}`);
            }

            // if we succeeded, print the new plant's ID
            const listOfPlantsFromResponse = JSON.parse(this.responseText); // actual list of plants from the server
            console.log('received a plant', listOfPlantsFromResponse);

            // removes old elements from the list of plants
            // while(listOfPlants.children.length !==0) {
            //     listOfPlants.removeChild(listOfPlants.children[0]);
            // }
            // same as above but instead we clear HTML
            listOfPlants.innerHTML = '';

            for (let i = 0; i < listOfPlantsFromResponse.length; ++i) {
                const newDiv = document.createElement('div');
                listOfPlants.appendChild(newDiv);
                newDiv.textContent = JSON.stringify(listOfPlantsFromResponse[i]);
            }

        };

        getAPlantRequest.open('GET', 'http://localhost:8080/api/v1/plants', true);
        // actually send the request
        getAPlantRequest.send();

    }

    createListOfPlants();

    function onPlantCreate() {
        // create plant object
        const plant = {
            "name": plantNameTextField.value,
            "colorRed": 255,
            "colorGreen": 0,
            "colorBlue": 255,
            "heightInInches": plantHeightTextField.value
        };

        // send POST request to the server
        const createAPlantRequest = new XMLHttpRequest();
        createAPlantRequest.onreadystatechange = function () {
            // when response didn't come yet, move on
            if (this.readyState !== 4) return;

            // if status is error, throw
            if (this.status !== 201) {
                throw new Error(`status is ${this.status}`);
            }

            // if we succeeded, print the new plant's ID
            const plantId = this.responseText;
            console.log('created a plant', plantId, plant);

            // clear the input fields
            plantNameTextField.value = '';
            plantColorTextField.value = '';
            plantHeightTextField.value = '';

            createListOfPlants();

        };

        createAPlantRequest.open('POST', 'http://localhost:8080/api/v1/plants', true);
        // tell the server we are sending a JSON
        createAPlantRequest.setRequestHeader('Content-Type', 'application/json');
        // actually send the request
        createAPlantRequest.send(JSON.stringify(plant));
    }
</script>
</html>